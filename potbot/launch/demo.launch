<launch>
  <arg name="GROUP"                       default="/robot_0"/>
  <arg name="IS_SIMULATOR"                default="false"/>
  <arg name="USE_RVIZ"                    default="true"/>
  <arg name="PUBLISH_COMMAND"             default="true"/>
  <arg name="FRAME_ID/GLOBAL"             default="map"/>
  <arg name="FRAME_ID/ROBOT_BASE"         default="robot_0/base_link"/>
  <arg name="FRAME_ID/LIDAR"              default="robot_0/base_scan"/>
  <arg name="TARGET/POSITION/X"           default="0"/>
  <arg name="TARGET/POSITION/Y"           default="0"/>
  <arg name="TARGET/POSITION/YAW"         default="0"/>
  <arg name="TOPIC/SCAN"                  default="/robot_0/scan"/>
  <arg name="TOPIC/ODOM"                  default="/robot_0/odom/fusion"/>
  <arg name="TOPIC/CMD_VEL"               default="/robot_0/cmd_vel"/>

  <group ns="$(arg GROUP)">

    <!-- <include file="$(find turtlebot3_bringup)/launch/turtlebot3_remote.launch">
      <arg name="model" value="waffle_pi" />
      <arg name="multi_robot_name" value="robot_0" />
    </include> -->

    <!-- <node pkg="map_server" name="map_server" type="map_server" args="$(find potbot_description)/maps/garage.yaml"/> -->

    <!-- <include file="$(find turtlebot3_navigation)/launch/amcl.launch">
      <arg name="initial_pose_x" default="2.0"/>
      <arg name="initial_pose_y" default="2.2"/>
      <arg name="initial_pose_a" default="-1.57"/>
    </include> -->

    <include file="$(find potbot)/launch/potbot_remote.launch">
      <!-- <arg name="model" value="megarover21"/> -->
      <arg name="urdf_file" default="$(find xacro)/xacro --inorder '$(find turtlebot3_description)/urdf/turtlebot3_waffle_pi.urdf.xacro'" />
      <arg name="multi_robot_name" value="robot_0"/>
    </include>

    <include file="$(find potbot)/launch/amcl.launch">
      <arg name="map_file"                value="$(find potbot_description)/maps/garage.yaml"/>
      <arg name="USE_RVIZ"                value="false"/>
      <arg name="initial_pose_x"          value="2.0"/>
      <arg name="initial_pose_y"          value="2.2"/>
      <arg name="initial_pose_a"          value="-1.57"/>
    </include>

    <node pkg="robot_localization" type="ukf_localization_node" name="ukf_se" clear_params="true" output="screen">
      <rosparam command="load"            file="$(find potbot_description)/config/waffle_pi_robot_localization.yaml" />
      <!-- <rosparam command="load"            file="$(find potbot_description)/config/megarover_robot_localization.yaml" /> -->
      <remap from="odometry/filtered"     to="odom/fusion"/>
    </node>

    <!-- <include file="$(find potbot_localization)/launch/Localization.launch">
      <arg name="IS_SIMULATOR"            value="$(arg IS_SIMULATOR)"/>
      <arg name="USE_RVIZ"                value="$(arg USE_RVIZ)"/>
      <arg name="FRAME_ID/GLOBAL"         value="$(arg FRAME_ID/GLOBAL)"/>
      <arg name="FRAME_ID/ROBOT_BASE"     value="$(arg FRAME_ID/ROBOT_BASE)"/>
      <arg name="FRAME_ID/LIDAR"          value="$(arg FRAME_ID/LIDAR)"/>
      <arg name="TOPIC/SCAN"              value="$(arg TOPIC/SCAN)"/>
      <arg name="TOPIC/ODOM"              value="$(arg TOPIC/ODOM)"/>
    </include> -->

    <!-- <include file="$(find potbot_controller)/launch/Controller.launch">
      <arg name="PUBLISH_COMMAND"         value="$(arg PUBLISH_COMMAND)"/>
      <arg name="FRAME_ID/GLOBAL"         value="$(arg FRAME_ID/GLOBAL)"/>
      <arg name="FRAME_ID/ROBOT_BASE"     value="$(arg FRAME_ID/ROBOT_BASE)"/>
      <arg name="TARGET/POSITION/X"       value="$(arg TARGET/POSITION/X)"/>
      <arg name="TARGET/POSITION/Y"       value="$(arg TARGET/POSITION/Y)"/>
      <arg name="TARGET/POSITION/YAW"     value="$(arg TARGET/POSITION/YAW)"/>
      <arg name="TOPIC/ODOM"              value="$(arg TOPIC/ODOM)"/>
      <arg name="TOPIC/CMD_VEL"           value="$(arg TOPIC/CMD_VEL)"/>
    </include>

    <include file="$(find potbot_filter)/launch/Filter.launch">
      <arg name="FRAME_ID/GLOBAL"         value="$(arg FRAME_ID/GLOBAL)"/>
      <arg name="FRAME_ID/ROBOT_BASE"     value="$(arg FRAME_ID/ROBOT_BASE)"/>
      <arg name="TOPIC/SCAN"              value="$(arg TOPIC/SCAN)"/>
    </include>
    
    <include file="$(find potbot_pathplanner)/launch/PathPlanning.launch">
      <arg name="USE_RVIZ"                value="$(arg USE_RVIZ)"/>
      <arg name="PATH_PLANNING_METHOD"    value="potential_method"/>
      <arg name="PATH_PLANNING_FILE"      default="straight.csv"/>
      <arg name="FRAME_ID/GLOBAL"         value="$(arg FRAME_ID/GLOBAL)"/>
      <arg name="FRAME_ID/ROBOT_BASE"     value="$(arg FRAME_ID/ROBOT_BASE)"/>
      <arg name="TARGET/POSITION/X"       value="$(arg TARGET/POSITION/X)"/>
      <arg name="TARGET/POSITION/Y"       value="$(arg TARGET/POSITION/Y)"/>
      <arg name="TARGET/POSITION/YAW"     value="$(arg TARGET/POSITION/YAW)"/>
      <arg name="TOPIC/SCAN"              value="$(arg TOPIC/SCAN)"/>
      <arg name="TOPIC/ODOM"              value="$(arg TOPIC/ODOM)"/>
    </include>

    <include file="$(find potbot_pcl)/launch/PCLClustering.launch">
      <arg name="TOPIC/PCL2"              value="realsense/depth/points"/>
      <arg name="CLUSTERING_METHOD"       value="Euclidean"/>
    </include>

    <include file="$(find potbot_localmap)/launch/Localmap.launch">
    </include> -->
    
    <group if="$(arg USE_RVIZ)">
      <include file="$(find potbot_rviz)/launch/rviz.launch">
        <arg name="RVIZ_FILE"             value="$(find potbot_description)/rviz/waffle_pi.rviz"/>
      </include>
    </group>

  </group>

</launch>
